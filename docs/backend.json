{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the game, tracked via anonymous authentication.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user. (Primary Key)"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name for the leaderboard."
        },
        "personalBestAccuracy": {
          "type": "number",
          "description": "The user's best (lowest) absolute difference from 18.00 seconds across all attempts.",
          "format": "float"
        },
        "totalAttempts": {
          "type": "number",
          "description": "The total number of attempts the user has made.",
          "format": "integer"
        },
        "lastPlayedTime": {
          "type": "string",
          "description": "The timestamp of the user's last game attempt.",
          "format": "date-time"
        }
      },
      "required": [
        "id"
      ]
    },
    "Attempt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attempt",
      "type": "object",
      "description": "Represents a single attempt by a user to stop the timer at 18 seconds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attempt. (Primary Key)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made this attempt. (Relationship: User 1:N Attempt)"
        },
        "stoppedTime": {
          "type": "number",
          "description": "The time at which the user stopped the timer.",
          "format": "float"
        },
        "deltaFromTarget": {
          "type": "number",
          "description": "The absolute difference between the stopped time and 18.00 seconds.",
          "format": "float"
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the attempt was made.",
          "format": "date-time"
        },
        "deviceType": {
          "type": "string",
          "description": "The type of device used to make the attempt (e.g., 'mobile', 'desktop')."
        }
      },
      "required": [
        "id",
        "userId",
        "stoppedTime",
        "deltaFromTarget",
        "timestamp",
        "deviceType"
      ]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents a single score on the global leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the entry."
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who set the score."
        },
        "userName": {
          "type": "string",
          "description": "The display name of the user."
        },
        "stoppedTime": {
          "type": "number",
          "description": "The time at which the user stopped the timer.",
          "format": "float"
        },
        "deltaFromTarget": {
          "type": "number",
          "description": "The absolute difference between the stopped time and 18.00 seconds.",
          "format": "float"
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the attempt was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "userName",
        "stoppedTime",
        "deltaFromTarget",
        "timestamp"
      ]
    },
    "GlobalStatistics": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GlobalStatistics",
      "type": "object",
      "description": "Represents aggregated statistics for all game attempts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the global statistics document. Should be a singleton. (Primary Key)"
        },
        "totalPlays": {
          "type": "number",
          "description": "The total number of game attempts made by all users.",
          "format": "integer"
        },
        "averageAccuracy": {
          "type": "number",
          "description": "The average accuracy (absolute difference from 18.00 seconds) across all attempts.",
          "format": "float"
        },
        "failPercentageRange": {
          "type": "number",
          "description": "The percentage of users who failed within a defined range around 18 seconds (e.g., 17.5 - 18.5).",
          "format": "float"
        }
      },
      "required": [
        "id"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles, including their personal best accuracy, total attempts, and last played time.  The 'userId' parameter represents the Firebase Authentication UID. This path enforces path-based ownership, simplifying security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/attempts/{attemptId}",
        "definition": {
          "entityName": "Attempt",
          "schema": {
            "$ref": "#/backend/entities/Attempt"
          },
          "description": "Stores individual game attempts made by a user. Located as a subcollection under the user's document to establish ownership and simplify querying for attempts made by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who made the attempt."
            },
            {
              "name": "attemptId",
              "description": "The unique identifier for the attempt."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{entryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores top scores for the global leaderboard. Publicly readable, but writes are restricted to the owner of the score.",
          "params": [
            {
              "name": "entryId",
              "description": "Unique ID for the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "/global_statistics/{singleton}",
        "definition": {
          "entityName": "GlobalStatistics",
          "schema": {
            "$ref": "#/backend/entities/GlobalStatistics"
          },
          "description": "Stores aggregated statistics for all game attempts. This is a singleton document, meaning there will only ever be one document in this collection.",
          "params": [
            {
              "name": "singleton",
              "description": "A fixed value, such as 'singleton', to ensure there is only one document in this collection."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the game, focusing on user data, attempt tracking, and global statistics. It emphasizes authorization independence and optimized querying for game-related data.\n\n1.  **Users Collection (`/users/{userId}`):** Stores user-specific data, including their display name, personal best accuracy, total attempts, and last played time. The `userId` is derived from Firebase Authentication's `uid`. This structure adheres to path-based ownership for private user data, simplifying security rules.\n\n2.  **Attempts Subcollection (`/users/{userId}/attempts/{attemptId}`):** Each user has a subcollection of attempts. This hierarchical structure establishes a clear ownership model (User 1:N Attempt). Each attempt document stores details like stopped time, delta from the target time (18 seconds), timestamp, and device type. Authorization independence is guaranteed because access control is implicitly tied to the `userId` in the path. List operations are automatically scoped to the user.\n\n3. **Leaderboard Collection (`/leaderboard/{entryId}`):** A root collection to store top scores globally. This allows for public, efficient querying of the top players without exposing any user's full attempt history. Writes are restricted to ensure users can only post their own scores.\n\n4.  **Global Statistics Document (`/global_statistics/singleton`):** A singleton document stores aggregated game statistics. Access to this document is configured via rules to ensure it is only writable by an administrative function (if write access is needed). This isolates global data from user-specific data.\n\n**Authorization Independence:** The structure achieves authorization independence by avoiding `get()` calls in security rules. User attempts are stored in a subcollection of the user's document, associating the attempt directly with the user's `uid`. Security rules can therefore directly verify that `request.auth.uid == userId` for creating or modifying attempts. Leaderboard entries are also verified against the authenticated user's UID on create.\n\n**QAPs (Rules are not Filters):**\n\n*   The segregation of user data, private attempts, and the public leaderboard into separate collections supports secure list operations. Listing attempts is always scoped to a specific user, and the leaderboard is designed to be public."
  }
}